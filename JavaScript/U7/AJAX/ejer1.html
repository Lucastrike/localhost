
<!DOCTYPE html>
<html>
<head>
  <title>Ejer1</title>
  <style media="screen">
    p {
      color: green;
    }
    p.updating{
      color: orange;
    }
  </style>
</head>
<body>

  <form>
    <select name="region" id="selectregion"></select>
    <select name="cities" id="selectcities"></select>
    <br>
    <br>
    <input name="city" rows="1" cols="10" id="text"></input>
    <input type="button" name="name" value="Update" id="update">
  </form>

  <script type="text/javascript" src="js/jquery-3.1.1.min.js"></script>

  <script>

  $(document).ready(function() {


    $.ajax({
      type: 'GET',
      url: 'getregions.php',
      success: function(data){
        $("#selectregion").html(data);
        $.ajax({
          type: 'GET',
          url: 'getcities.php',
          data: $("form").serialize(),
          success: function(response){
            $("#selectcities").html(response);
          }
        });
      }
      /*beforeSend: function(){
        $("<p>Updating...</p>").insertAfter("#update");
      }*/
    });


    $("#selectregion").on('change', function(){
      $.ajax({
        type: 'POST',
        url: 'getcities.php',
        data: $("form").serialize(),
        success: function(response){
          $("#selectcities").html(response);
        }
      });
    });

      $("#selectcities").on('change', function(){
        $("#text").val($("#selectcities option:selected").html());
      });

      $("#selectcities").on('click', function(){
        var city = $("#selectcities").val();
        $("#text").val(city);
      });

      $("#update").on('click', function(){
        var city = $("#text").val();
        $.ajax({
          type: 'POST',
          url: 'insertCity.php',
          data: $("form").serialize(),
          success: function(response){
            $("#selectcities").html(response);
            $("#selectcities option[value='"+city+"']").attr("selected", "true");
            $("<p>City updated!</p>").css("display", "inline-block").insertAfter("#update");
            $("p.updating").hide();
          },
          beforeSend: function(){
            $("<p class='updating'>Updating...</p>").css("display", "inline-block").insertAfter("#update");
          },
          complete: function(){

          }
         });
      });
});

  </script>
  <script>
    /*$(document).ready(function() {

        $.get("getregions.php", function(data){
          $("#selectregion").html(data);
          $.get("getcities.php",{
            region: $("#selectregion").val()
          }, function(response){
            $("#selectcities").html(response);
            }
          );
        }
      );

        $("#selectregion").on('change', function(){
          $.get("getcities.php",{
            region: $("#selectregion").val()
          }, function(response){
            $("#selectcities").html(response);
            }
          );
        });

        $("#selectcities").on('change', function(){
          $("#text").val($("#selectcities option>selected").html());
        });

        $("#selectcities").on('click', function(){
          var city = $("#selectcities").val();
          $("#text").val(city);
        });

        $("#update").on('click', function(){
          $.post("insertCity.php",{
            input: $("#text").val(),
            city: $("#selectcities").val(),
            id: $("#selectregion").val()
          }, function(response){
            $("#selectcities").html(response);
          }
        );
        });


  });*/

  </script>

</body>
</html>
